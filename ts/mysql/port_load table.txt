create table portfolio_load
(reporting_account_number  VARCHAR(200),
reporting_account_name  VARCHAR(200),
source_account_number  VARCHAR(200),
source_account_name  VARCHAR(200),
as_of_date  VARCHAR(200),
security_description_1  VARCHAR(200),
security_description_2  VARCHAR(200),
asset_code  VARCHAR(200),
asset_category  VARCHAR(200),
sector_name  VARCHAR(200),
position_type  VARCHAR(200),
acct_base_currency_code  VARCHAR(200),
acct_base_currency_name  VARCHAR(200),
local_currency_code  VARCHAR(200),
local_currency_name  VARCHAR(200),
country_code  VARCHAR(200),
country_name  VARCHAR(200),
shares_par  VARCHAR(200),
base_cost  VARCHAR(200),
local_cost  VARCHAR(200),
base_price  VARCHAR(200),
local_price  VARCHAR(200),
base_net_income_receivable  VARCHAR(200),
local_net_income_receivable  VARCHAR(200),
base_market_value  VARCHAR(200),
local_market_value  VARCHAR(200),
base_notional_cost  VARCHAR(200),
local_notional_cost  VARCHAR(200),
base_notional_value  VARCHAR(200),
local_notional_value  VARCHAR(200),
coupon_rate  VARCHAR(200),
maturity_date  VARCHAR(200),
base_unrealized_gain_loss  VARCHAR(200),
local_unrealized_gain_loss  VARCHAR(200),
base_unrealized_currency_gain_loss  VARCHAR(200),
base_net_unrealized_gain_loss  VARCHAR(200),
gen_ledger_acct  VARCHAR(200),
pay_date  VARCHAR(200),
report_run_date  VARCHAR(200),
percent_of_total  VARCHAR(200),
link_ref  VARCHAR(200),
issuer_id  VARCHAR(200),
counterparty_name  VARCHAR(200),
exchange_rate  VARCHAR(200),
original_strike_price  VARCHAR(200),
current_strike_price  VARCHAR(200),
mellon_security_id  VARCHAR(200),
cins  VARCHAR(200),
cusip  VARCHAR(200),
ticker  VARCHAR(200),
isin  VARCHAR(200),
sedol  VARCHAR(200),
valoren  VARCHAR(200),
sicovam  VARCHAR(200),
wpk  VARCHAR(200),
quick  VARCHAR(200),
underlying_sec_id  VARCHAR(200),
loan_id  VARCHAR(200),
manager  VARCHAR(200),
counterparty  VARCHAR(200),
derivative_type  VARCHAR(200),
acctg_status_update_est  VARCHAR(200),
underlying_security_description_1  VARCHAR(200),
underlying_security_description_2  VARCHAR(200),
underlying_security_cusip  VARCHAR(200),
underlying_security_cins  VARCHAR(200),
underlying_security_isin  VARCHAR(200),
underlying_security_sedol  VARCHAR(200),
underlying_security_ticker  VARCHAR(200),
underlying_security_sicovam  VARCHAR(200),
underlying_security_valoren  VARCHAR(200),
underlying_security_wpk  VARCHAR(200),
underlying_security_quick  VARCHAR(200),
underlying_security_loan_id  VARCHAR(200),
underlying_security_manager  VARCHAR(200),
accounting_status  VARCHAR(200));

create table portfolio_arch
(archived_at DATETIME,
trading_group         varchar(20),
security_description  varchar(100),
local_currency_code   varchar(20),
shares_par            double     ,
base_cost             double     ,
local_cost            double     ,
base_market_value     double     ,
report_run_date       date       ,
ticker                varchar(20),
isin                  varchar(20));

drop view if exists portfolio;
create view portfolio as
select CONCAT(left(reporting_account_number,8),right(reporting_account_number,3)) trading_group,
security_description_1 security_description,
local_currency_code,
REPLACE(shares_par,',','')+0 shares_par,
REPLACE(base_cost,',','')+0 base_cost,
REPLACE(local_cost,',','')+0 local_cost,
ROUND(REPLACE(base_market_value,',','')+0 + REPLACE(base_net_income_receivable,',',''),2) base_market_value,
STR_TO_DATE(report_run_date,'%m/%d/%Y') report_run_date,
ticker,
isin
from portfolio_load;
